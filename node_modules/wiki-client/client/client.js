/*! wiki-client - v0.5.3 - 2015-10-09
 * Copyright 2015 Ward Cunningham and other contributors; Licensed  */
!function a(b,c,d){function e(g,h){if(!c[g]){if(!b[g]){var i="function"==typeof require&&require;if(!h&&i)return i(g,!0);if(f)return f(g,!0);var j=new Error("Cannot find module '"+g+"'");throw j.code="MODULE_NOT_FOUND",j}var k=c[g]={exports:{}};b[g][0].call(k.exports,function(a){var c=b[g][1][a];return e(c?c:a)},k,k.exports,a,b,c,d)}return c[g].exports}for(var f="function"==typeof require&&require,g=0;g<d.length;g++)e(d[g]);return e}({1:[function(a,b,c){console.log("Window Name: "+window.name),window.name=window.location.host,window.wiki=a("./lib/wiki"),a("./lib/legacy"),a("./lib/bind"),a("./lib/plugins")},{"./lib/bind":5,"./lib/legacy":14,"./lib/plugins":25,"./lib/wiki":37}],2:[function(a,b,c){var d,e,f;f={create:"☼",add:"+",edit:"✎",fork:"⚑",move:"↕",remove:"✕"},e=f.fork,d=f.add,b.exports={symbols:f,fork:e,add:d}},{}],3:[function(a,b,c){var d,e,f;b.exports=d={},d.scrollContainer=void 0,e=function(){var a;return a=$("body, html").filter(function(){return $(this).scrollLeft()>0}),a.length>0?a:$("body, html").scrollLeft(12).filter(function(){return $(this).scrollLeft()>0}).scrollTop(0)},f=function(a){var b,c,f,g,h,i;if(null!=a.position())return null==d.scrollContainer&&(d.scrollContainer=e()),b=$("body").width(),g=d.scrollContainer.scrollLeft(),f=g+b,h=a.position().left,i=a.outerWidth(!0),c=$(".page").outerWidth(!0)*$(".page").size(),g>h?d.scrollContainer.animate({scrollLeft:h}):h+i>f?d.scrollContainer.animate({scrollLeft:h-(b-i)}):f>$(".pages").outerWidth()?d.scrollContainer.animate({scrollLeft:Math.min(h,c-b)}):void 0},d.set=function(a){return a=$(a),$(".active").removeClass("active"),f(a.addClass("active"))}},{}],4:[function(a,b,c){var d,e;e=a("./util"),d=a("./actionSymbols"),b.exports=function(a,b){var c,f,g,h;return f=a.parents(".page:first"),h="",null!=b.site&&(h+=b.site+"\n"),h+=b.type||"separator",null!=b.date&&(h+=" "+e.formatElapsedTime(b.date)),c=$('<a href="#" /> ').addClass("action").addClass(b.type||"separator").text(b.symbol||d.symbols[b.type]).attr("title",h).attr("data-id",b.id||"0").data("action",b),g=a.children(".control-buttons"),g.length>0?c.insertBefore(g):c.appendTo(a),"fork"===b.type&&null!=b.site?c.css("background-image","url(//"+b.site+"/favicon.png)").attr("href","//"+b.site+"/"+f.attr("id")+".html").attr("target",""+b.site).data("site",b.site).data("slug",f.attr("id")):void 0}},{"./actionSymbols":2,"./util":36}],5:[function(a,b,c){var d,e,f,g,h;e=a("./neighborhood"),f=a("./neighbors"),g=a("./searchbox"),h=a("./state"),d=a("./link"),$(function(){return g.inject(e),g.bind(),f.inject(e),f.bind(),window.seedNeighbors&&seedNeighbors.split(",").forEach(function(a){return e.registerNeighbor(a.trim())}),h.inject(d)})},{"./link":17,"./neighborhood":18,"./neighbors":19,"./searchbox":32,"./state":33}],6:[function(a,b,c){var d,e,f,g;g=a("./resolve"),d=null,e=function(){return d=$("<div></div>").html("This dialog will show every time!").dialog({autoOpen:!1,title:"Basic Dialog",height:600,width:800})},f=function(a,b){return d.html(b),d.dialog("option","title",g.resolveLinks(a)),d.dialog("open")},b.exports={emit:e,open:f}},{"./resolve":29}],7:[function(a,b,c){var d,e,f,g,h,i=[].indexOf||function(a){for(var b=0,c=this.length;c>b;b++)if(b in this&&this[b]===a)return b;return-1};e=function(a){var b;return null!=(b=a.originalEvent.dataTransfer)&&i.call(b.types,"Files")>=0?b.files[0]:null},g=function(a){var b,c;return null!=(b=a.originalEvent.dataTransfer)&&null!=b.types&&(i.call(b.types,"text/uri-list")>=0||i.call(b.types,"text/x-moz-url")>=0)&&(c=b.getData("URL"),null!=c?c.length:void 0)?c:null},f=function(a){var b,c,d,e,f;return(b=a.match(/^http:\/\/([a-zA-Z0-9:.-]+)(\/([a-zA-Z0-9:.-]+)\/([a-z0-9-]+(_rev\d+)?))+$/))?(d={},c=b[0],e=b[1],c=b[2],d.site=b[3],d.slug=b[4],c=b[5],("view"===(f=d.site)||"local"===f||"origin"===f)&&(d.site=e),d):null},h=function(a){var b;return(b=a.match(/^https?:\/\/www.youtube.com\/watch\?v=([\w\-]+).*$/))?{text:"YOUTUBE "+b[1]}:(b=a.match(/^https?:\/\/youtu.be\/([\w\-]+).*$/))?{text:"YOUTUBE "+b[1]}:(b=a.match(/www.youtube.com%2Fwatch%3Fv%3D([\w\-]+).*$/))?{text:"YOUTUBE "+b[1]}:(b=a.match(/^https?:\/\/vimeo.com\/([0-9]+).*$/))?{text:"VIMEO "+b[1]}:(b=a.match(/url=https?%3A%2F%2Fvimeo.com%2F([0-9]+).*$/))?{text:"VIMEO "+b[1]}:(b=a.match(/https?:\/\/archive.org\/details\/([\w\.\-]+).*$/))?{text:"ARCHIVE "+b[1]}:(b=a.match(/https?:\/\/tedxtalks.ted.com\/video\/([\w\-]+).*$/))?{text:"TEDX "+b[1]}:(b=a.match(/https?:\/\/www.ted.com\/talks\/([\w\.\-]+).*$/))?{text:"TED "+b[1]}:null},d=function(a){return function(b){var c,d,i,j,k,l,m,n;if(l=function(a){return b.preventDefault(),b.stopPropagation()},m=g(b)){if((i=f(m))&&null!=(d=a.page))return l(d(i));if((n=h(m))&&null!=(d=a.video))return l(d(n));j={url:m}}if(c=e(b)){if(null!=(d=a.file))return l(d(c));j={file:c}}return null!=(d=a.punt)?(j||(j={dt:b.dataTransfer,types:null!=(k=b.dataTransfer)?k.types:void 0}),l(d(j))):void 0}},b.exports={dispatch:d}},{}],8:[function(a,b,c){var d,e,f,g,h,i,j,k,l,m;i=a("./plugin"),f=a("./itemz"),h=a("./pageHandler"),g=a("./link"),j=a("./random"),d=function(a){return a.replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;")},m=function(a,b,c){var j,n,o,p,q,r;return null==c&&(c={}),console.log("textEditor",b.id,c),o=function(d){var h,i,k,n,o,p,q,r,s;if((d.altKey||d.ctlKey||d.metaKey)&&83===d.which)return j.focusout(),!1;if((d.altKey||d.ctlKey||d.metaKey)&&73===d.which)return d.preventDefault(),d.shiftKey||(n=$(d.target).parents(".page")),g.doInternalLink("about "+b.type+" plugin",n),!1;if("paragraph"===b.type){if(q=e(j),d.which===$.ui.keyCode.BACKSPACE&&0===q.start&&q.start===q.end)return i=a.prev(),p=f.getItem(i),"paragraph"!==p.type?!1:(k=p[c.field||"text"].length,r=j.val(),j.val(""),m(i,p,{caret:k,suffix:r}),!1);if(d.which===$.ui.keyCode.ENTER)return q?(h=a.parent().parent(),s=j.val(),o=s.substring(0,q.start),r=s.substring(q.end),""===o?(j.val(r),j.focusout(),l(h,a.prev(),o,!0)):(j.val(o),j.focusout(),l(h,a,r)),!1):!1}},n=function(){var d;if(a.removeClass("textEditing"),j.unbind(),d=a.parents(".page:first"),b[c.field||"text"]=j.val())if(i["do"](a.empty(),b),c.after){if(""===b[c.field||"text"])return;h.put(d,{type:"add",id:b.id,item:b,after:c.after})}else{if(b[c.field||"text"]===p)return;h.put(d,{type:"edit",id:b.id,item:b})}else c.after||h.put(d,{type:"remove",id:b.id}),a.remove();return null},a.hasClass("textEditing")?void 0:(a.addClass("textEditing"),a.unbind(),p=null!=(q=b[c.field||"text"])?q:"",j=$("<textarea>"+d(p)+d(null!=(r=c.suffix)?r:"")+"</textarea>").focusout(n).bind("keydown",o),a.html(j),c.caret?k(j,c.caret):c.append?(k(j,j.val().length),j.scrollTop(j[0].scrollHeight-j.height())):j.focus())},l=function(a,b,c){var d,e,g;return g={type:"paragraph",id:j.itemId(),text:c},d=$('<div class="item paragraph" data-id='+g.id+"></div>"),d.data("item",g).data("pageElement",a),b.after(d),i["do"](d,g),e=f.getItem(b),m(d,g,{after:null!=e?e.id:void 0})},e=function(a){var b,c,d;return b=a.get(0),document.selection?(b.focus(),d=document.selection.createRange(),d.moveStart("character",-b.value.length),c=d.text.length,{start:c,end:c}):{start:b.selectionStart,end:b.selectionEnd}},k=function(a,b){var c,d;return c=a.get(0),null!=c?(c.createTextRange?(d=c.createTextRange(),d.move("character",b),d.select()):c.setSelectionRange(b,b),c.focus()):void 0},b.exports={textEditor:m}},{"./itemz":13,"./link":17,"./pageHandler":21,"./plugin":24,"./random":26}],9:[function(a,b,c){var d,e,f,g,h,i,j,k,l,m,n,o,p;k=a("./neighborhood"),m=a("./plugin"),o=a("./resolve"),l=a("./pageHandler"),h=a("./editor"),p=a("./synopsis"),g=a("./drop"),j=function(a){return a.replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/\n/g,"<br>")},i=function(a,b){var c,d;return a.append("<p>Double-Click to Edit<br>Drop Text or Image to Insert</p>"),c=function(){var c,d,e,f,g,i;for(g=a.find("p").append('<br>Or Choose a Plugin\n<center>\n<table style="text-align:left;">\n<tr><td><ul id=format><td><ul id=data><td><ul id=other>'),i=window.catalog,d=0,f=i.length;f>d;d++)e=i[d],c=e.category||"other","format"!==c&&"data"!==c&&(c="other"),g.find("#"+c).append('<li><a class="menu" href="#" title="'+e.title+'">'+e.name+"</a></li>");return g.find("a.menu").click(function(c){return a.removeClass("factory").addClass(b.type=c.target.text.toLowerCase()),a.unbind(),h.textEditor(a,b)})},d=function(){return a.append("<p>"+o.resolveLinks(b.prompt,j)+"</b>")},b.prompt?d():null!=window.catalog?c():$.getJSON("/system/factories.json",function(a){return window.catalog=a,c()})},e=function(a,b){var c,e,i,j,o;return o=function(){var c,d,e;a.empty().unbind(),a.removeClass("factory").addClass(b.type),c=a.parents(".page:first");try{a.data("pageElement",c),a.data("item",b),m.getPlugin(b.type,function(c){return c.emit(a,b),c.bind(a,b)})}catch(e){d=e,a.append("<p class='error'>"+d+"</p>")}return l.put(c,{type:"edit",id:b.id,item:b})},i=function(a){return b.prompt="Unexpected Item\nWe can't make sense of the drop.\nTry something else or see [[About Factory Plugin]].",a.userAgent=navigator.userAgent,b.punt=a,o()},c=function(a){return $.getJSON("http://"+a.site+"/"+a.slug+".json",function(c){return b.type="reference",b.site=a.site,b.slug=a.slug,b.title=c.title||a.slug,b.text=p(c),o(),null!=b.site?k.registerNeighbor(b.site):void 0})},e=function(a){return b.type="video",b.text=a.text+"\n(double-click to edit caption)\n",o()},j=function(a){var c,e,g,h;return null!=a?(h=a.type.split("/"),c=h[0],e=h[1],g=new FileReader,"image"===c?(g.onload=function(a){return b.type="image",b.url=n(a.target.result),b.caption||(b.caption="Uploaded image"),o()},g.readAsDataURL(a)):"text"===c?(g.onload=function(c){var g,h;return h=c.target.result,"csv"===e?(b.type="data",b.columns=(g=f(h))[0],b.data=d(g),b.text=a.fileName):(b.type="paragraph",b.text=h),o()},g.readAsText(a)):i({name:a.name,type:a.type,size:a.size,fileName:a.fileName,lastModified:a.lastModified})):void 0},a.dblclick(function(c){return c.shiftKey?h.textEditor(a,b,{field:"prompt"}):(a.removeClass("factory").addClass(b.type="paragraph"),a.unbind(),h.textEditor(a,b))}),a.bind("dragenter",function(a){return a.preventDefault()}),a.bind("dragover",function(a){return a.preventDefault()}),a.bind("drop",g.dispatch({page:c,file:j,video:e,punt:i}))},f=function(a,b){var c,d,e,f,g;for(b=b||",",e=new RegExp("(\\"+b+'|\\r?\\n|\\r|^)(?:"([^"]*(?:""[^"]*)*)"|([^"\\'+b+"\\r\\n]*))","gi"),c=[[]],d=null;d=e.exec(a);)f=d[1],f.length&&f!==b&&c.push([]),g=d[2]?d[2].replace(new RegExp('""',"g"),'"'):d[3],c[c.length-1].push(g);return c},d=function(a){var b,c,d,e,f,g;for(b=a.shift(),g=function(a){var c,d,e,f,g,h,i;for(f={},g=_.zip(b,a),c=0,e=g.length;e>c;c++)h=g[c],d=h[0],i=h[1],null!=i&&i.match(/\S/)&&"NULL"!==i&&(f[d]=i);return f},e=[],c=0,d=a.length;d>c;c++)f=a[c],e.push(g(f));return e},n=function(a){var b,c,d;return c=function(a){return a.width<=500||a.height<=300},d=function(a){var b,e,f,g;return c(a)?a:(f=document.createElement("canvas"),f.width=e=a.width/2,f.height=b=a.height/2,g=f.getContext("2d"),g.drawImage(a,0,0,e,b),d(f))},b=new Image,b.src=a,c(b)?a:d(b).toDataURL("image/jpeg",.5)},b.exports={emit:i,bind:e}},{"./drop":7,"./editor":8,"./neighborhood":18,"./pageHandler":21,"./plugin":24,"./resolve":29,"./synopsis":34}],10:[function(a,b,c){var d,e,f,g;g=a("./resolve"),f=a("./neighborhood"),e=function(a,b){var c,d,e,h,i;if(a.append(b.text+'<br><br><button class="create">create</button> new blank page'),null!=(d=f.sites[location.host])&&null!=d.sitemap){for(h=d.sitemap,i=[],c=0,e=h.length;e>c;c++)b=h[c],b.slug.match(/-template$/)?i.push(a.append('<br><button class="create" data-slug='+b.slug+">create</button> from "+g.resolveLinks("[["+b.title+"]]"))):i.push(void 0);return i}},d=function(a,b){},b.exports={emit:e,bind:d}},{"./neighborhood":18,"./resolve":29}],11:[function(a,b,c){var d,e,f,g,h;e=a("./dialog"),f=a("./editor"),h=a("./resolve"),g=function(a,b){return b.text||(b.text=b.caption),a.append('<img class=thumbnail src="'+b.url+'"> <p>'+h.resolveLinks(b.text)+"</p>")},d=function(a,b){return a.dblclick(function(){return f.textEditor(a,b)}),a.find("img").dblclick(function(){return e.open(b.text,this)})},b.exports={emit:g,bind:d}},{"./dialog":6,"./editor":8,"./resolve":29}],12:[function(a,b,c){var d,e,f,g,h,i;i=a("./util"),g=a("./link"),h=a("./page").newPage,f=function(a){return a.replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;")},e=function(a,b){var c;return c=function(a){var b,c,d,e,g;e=[];for(g in a)d=a[g],c="<a href="+g+">"+(f(d.title)||g)+"</a>",d.journal&&(c+=(b=d.journal[d.journal.length-1].date)?" &nbsp; from "+i.formatElapsedTime(b):" &nbsp; from revision "+(d.journal.length-1)),e.push(c);return e.join("<br>")},a.append('<p style="background-color:#eee;padding:15px;">\n  '+c(b.pages)+"\n</p>")},d=function(a,b){return a.find("a").click(function(a){var c,d,e;return e=$(a.target).attr("href"),a.shiftKey||(c=$(a.target).parents(".page")),d=h(b.pages[e]),g.showResult(d,{$page:c,rev:d.getRevision()}),!1})},b.exports={emit:e,bind:d}},{"./link":17,"./page":20,"./util":36}],13:[function(a,b,c){var d,e,f,g,h,i,j,k;f=a("./pageHandler"),g=a("./plugin"),h=a("./random"),k=function(a,b){return setTimeout(b,a)},e=function(a){return $(a).length>0?$(a).data("item")||$(a).data("staticItem"):void 0},i=function(a,b){return f.put(a.parents(".page:first"),{type:"remove",id:b.id}),a.remove()},d=function(a,b,c){var d,i;return null==a&&(a=b.parents(".page")),c.id=h.itemId(),d=$('<div class="item '+c.type+'" data-id=""</div>'),d.data("item",c).data("pageElement",a),null!=b?b.after(d):a.find(".story").append(d),g["do"](d,c),i=e(b),k(500,function(){return f.put(a,{item:c,id:c.id,type:"add",after:null!=i?i.id:void 0})}),d},j=function(a,b,c){var d,e,h,i;i=$.extend({},c),a.empty().unbind(),a.removeClass(b).addClass(i.type),d=a.parents(".page:first");try{a.data("pageElement",d),a.data("item",i),g.getPlugin(c.type,function(b){return b.emit(a,i),b.bind(a,i)})}catch(h){e=h,a.append("<p class='error'>"+e+"</p>")}return f.put(d,{type:"edit",id:i.id,item:i})},b.exports={createItem:d,removeItem:i,getItem:e,replaceItem:j}},{"./pageHandler":21,"./plugin":24,"./random":26}],14:[function(a,b,c){var d,e,f,g,h,i,j,k,l,m,n;k=a("./pageHandler"),m=a("./state"),d=a("./active"),l=a("./refresh"),h=a("./lineup"),g=a("./drop"),f=a("./dialog"),i=a("./link"),n=a("./target"),e=a("./page").asSlug,j=a("./page").newPage,$(function(){var b,c,e,o,p,q,r;return f.emit(),b=37,c=39,$(document).keydown(function(a){var e,f,g;return e=function(){switch(a.which){case b:return-1;case c:return 1}}(),e&&"TEXTAREA"!==a.target.tagName&&(g=$(".page"),f=g.index($(".active"))+e,f>=0&&f<g.length)?d.set(g.eq(f)):void 0}),$(window).on("popstate",m.show),$(document).ajaxError(function(a,b,c){return 0!==b.status&&404!==b.status?console.log("ajax error",a,b,c):void 0}),e=function(a){return(""+a).replace(/(\d)(?=(\d\d\d)+(?!\d))/g,"$1,")},r=function(a){var b;return"application/json"===(null!=a?a.type:void 0)?(b=new FileReader,b.onload=function(b){var c,d,f;return d=b.target.result,c=JSON.parse(d),f=j(),f.setTitle("Import from "+a.name),f.addParagraph("Import of "+Object.keys(c).length+" pages\n("+e(a.size)+" bytes)\nfrom an export file dated "+a.lastModifiedDate+"."),f.addItem({type:"importer",pages:c}),i.showResult(f)},b.readAsText(a)):void 0},p=function(a,b){return a?(console.log("getTemplate",a),k.get({whenGotten:function(a,c){return b(a)},whenNotGotten:function(){return b(null)},pageInformation:{slug:a}})):b(null)},o=function(a,b){var c;return a.preventDefault(),a.shiftKey||(c=$(a.target).parents(".page")),i.doInternalLink(b,c,$(a.target).data("site")),!1},$(".main").delegate(".show-page-source","click",function(a){var b,c;return a.preventDefault(),b=$(this).parent().parent(),c=h.atKey(b.data("key")).getRawPage(),f.open("JSON for "+c.title,$("<pre/>").text(JSON.stringify(c,null,2)))}).delegate(".page","click",function(a){return $(a.target).is("a")?void 0:d.set(this)}).delegate(".internal","click",function(a){var b;return b=$(a.target).data("pageName"),b=""+b,k.context=$(a.target).attr("title").split(" => "),o(a,b)}).delegate("img.remote","click",function(a){var b;return b=$(a.target).data("slug"),k.context=[$(a.target).data("site")],o(a,b)}).delegate(".revision","dblclick",function(a){var b,c,d,e,g;return a.preventDefault(),b=$(this).parents(".page"),e=h.atKey(b.data("key")).getRawPage(),g=e.journal.length-1,c=e.journal[g],d=JSON.stringify(c,null,2),f.open("Revision "+g+", "+c.type+" action",$("<pre/>").text(d))}).delegate(".action","click",function(a){var b,c,e,f,g,j;return a.preventDefault(),b=$(a.target),b.is(".fork")&&null!=(f=b.data("slug"))?(k.context=[b.data("site")],o(a,f.split("_")[0])):(c=$(this).parents(".page"),e=c.data("key"),j=h.atKey(e).getSlug(),g=$(this).parent().children().not(".separator").index(b),0>g?void 0:(a.shiftKey||c.nextAll().remove(),a.shiftKey||h.removeAllAfterKey(e),i.createPage(j+"_rev"+g,c.data("site")).appendTo($(".main")).each(l.cycle),d.set($(".page").last())))}).delegate(".fork-page","click",function(a){var b,c,d;if(b=$(a.target).parents(".page"),d=h.atKey(b.data("key")),c={type:"fork"},b.hasClass("local")){if(k.useLocalStorage())return;b.removeClass("local")}else d.isRemote()&&(c.site=d.getRemoteSite());return null!=b.data("rev")&&(b.removeClass("ghost"),b.find(".revision").remove()),k.put(b,c)}).delegate("button.create","click",function(a){return p($(a.target).data("slug"),function(b){var c,d,e;return c=$(a.target).parents(".page:first"),c.removeClass("ghost"),e=h.atKey(c.data("key")),e.become(b),d=e.getRawPage(),l.rebuildPage(e,c.empty()),k.put(c,{type:"create",id:d.id,item:{title:d.title,story:d.story}})})}).delegate(".score","hover",function(a){return $(".main").trigger("thumb",$(a.target).data("thumb"))}).bind("dragenter",function(a){return a.preventDefault()}).bind("dragover",function(a){return a.preventDefault()}).bind("drop",g.dispatch({page:function(a){return i.doInternalLink(a.slug,null,a.site)},file:function(a){return r(a)}})),$(".provider input").click(function(){return $("footer input:first").val($(this).attr("data-provider")),$("footer form").submit()}),$("body").on("new-neighbor-done",function(a,b){return $(".page").each(function(a,b){return l.emitTwins($(b))})}),q=a("./lineupActivity"),$("<span class=menu> &nbsp; &equiv; &nbsp; </span>").css({cursor:"pointer","font-size":"120%"}).appendTo("footer").click(function(){return f.open("Lineup Activity",q.show())}),n.bind(),$(function(){return m.first(),$(".page").each(l.cycle),d.set($(".page").last())})})},{"./active":3,"./dialog":6,"./drop":7,"./lineup":15,"./lineupActivity":16,"./link":17,"./page":20,"./pageHandler":21,"./refresh":28,"./state":33,"./target":35}],15:[function(a,b,c){var d,e,f,g,h,i,j,k,l,m,n,o,p,q,r=[].indexOf||function(a){for(var b=0,c=this.length;c>b;b++)if(b in this&&this[b]===a)return b;return-1};n=a("./random"),m={},k=[],d=function(a){var b;return b=n.randomBytes(4),m[b]=a,k.push(b),b},p=function(a){return r.call(k,a)<0?null:(k=k.filter(function(b){return a!==b}),delete m[a],a)},o=function(a){var b,c;if(b=[],r.call(k,a)<0)return b;for(;k[k.length-1]!==a;)c=k.pop(),b.unshift(c),delete m[c];return b},e=function(a){return m[a]},q=function(a){return e(a).getTitle()},f=function(){return k.length?q(k[k.length-1]):"Wiki"},h=function(){return k},i=function(){return m={},k=[]},j=function(a){var b,c,d;if((b=""+k)!=(d=""+a)&&(console.log("The lineup is out of sync with the dom."),console.log(".pages:",a),console.log("lineup:",k),""+Object.keys(k).sort()==""+Object.keys(a).sort()))return console.log("It looks like an ordering problem we can fix."),c=a},l=function(a){var b;return b=k.indexOf(a),1>b?null:k[b-1]},g=function(a,b){var c,d,e,f,g,h;return f=m[a],d=f.getRemoteSite(b),g=["view",h=f.getSlug()],"welcome-visitors"!==h&&g.unshift("view","welcome-visitors"),d!==b&&null!=(e=l(a))&&((c=m[e]).isRemote()||g.push(b,c.getSlug())),g.unshift(d),g},b.exports={addPage:d,removeKey:p,removeAllAfterKey:o,atKey:e,titleAtKey:q,bestTitle:f,debugKeys:h,debugReset:i,crumbs:g,debugSelfCheck:j}},{"./random":26}],16:[function(a,b,c){var d,e,f,g,h,i,j,k,l,m;g=a("./lineup"),e=24*(f=60*(h=60*(j=1e3))),d=function(a,b,c){var d,e,f;for(e=0,f=a.length;f>e;e++)if(d=a[e],null!=d.date&&b<d.date&&d.date<=c)return!0;return!1},l=function(a){var b,c,f,g,h;for(g="",b=60,c=(new Date).getTime()-b*e,f=1,h=b;h>=1?h>=f:f>=h;h>=1?f++:f--)g+=d(a,c,c+e)?"|":".",5===new Date(c).getDay()&&(g+="<td>"),c+=e;return g},i=function(a){var b,c;return b=a.getRemoteSite(location.host),c=a.getTitle(),"<tr><td align=right>\n  "+l(a.getRawPage().journal)+'\n<td>\n  <img class="remote" src="//'+b+'/favicon.png">\n  '+c},m=function(a){var b;return"<table>\n"+function(){var c,d,e;for(e=[],c=0,d=a.length;d>c;c++)b=a[c],e.push(i(g.atKey(b)));return e}().join("\n")+'\n</table>\n<p style="color: #bbb">dots are days, advancing to the right, with marks showing activity</p>'},k=function(){return m(g.debugKeys())},b.exports={show:k}},{"./lineup":15}],17:[function(a,b,c){var d,e,f,g,h,i,j,k,l,m;h=a("./lineup"),d=a("./active"),k=a("./refresh"),j=a("./page"),e=j.asSlug,i=j.pageEmitter,f=function(a,b){var c,d;return b&&"view"!==b&&(d=b),c=$('<div class="page" id="'+a+'">\n  <div class="twins"> <p> </p> </div>\n  <div class="header">\n    <h1> <img class="favicon" src="'+(d?"//"+d:"")+'/favicon.png" height="32px"> '+a+" </h1>\n  </div>\n</div>"),d&&c.data("site",d),c},l=function(a,b){return f(a,b).appendTo(".main").each(k.cycle)},g=function(a,b,c){return null==c&&(c=null),a=e(a.split("|")[0]),null!=b&&$(b).nextAll().remove(),null!=b&&h.removeAllAfterKey($(b).data("key")),l(a.split("|")[0],c),d.set($(".page").last())},m=function(a,b){var c,e;return null==b&&(b={}),null!=b.$page&&$(b.$page).nextAll().remove(),null!=b.$page&&h.removeAllAfterKey($(b.$page).data("key")),e=a.getSlug(),null!=b.rev&&(e+="_rev"+b.rev),c=f(e).addClass("ghost"),c.appendTo($(".main")),k.buildPage(a,c),d.set($(".page").last())},i.on("show",function(a){return console.log("pageEmitter handling",a),m(a)}),b.exports={createPage:f,doInternalLink:g,showPage:l,showResult:m}},{"./active":3,"./lineup":15,"./page":20,"./refresh":28}],18:[function(a,b,c){var d,e,f,g,h,i={}.hasOwnProperty;d=a("underscore"),b.exports=e={},e.sites={},f=0,g=500,h=function(a,b){var c,d,e;if(!b.sitemapRequestInflight)return b.sitemapRequestInflight=!0,e=function(a,b,c){return $('.neighbor[data-site="'+a+'"]').find("div").removeClass(b).addClass(c)},c=function(){var c,d;return d="http://"+a+"/system/sitemap.json",e(a,"wait","fetch"),c=$.ajax({type:"GET",dataType:"json",url:d}),c.always(function(){return b.sitemapRequestInflight=!1}).done(function(c){return b.sitemap=c,e(a,"fetch","done"),$("body").trigger("new-neighbor-done",a)}).fail(function(b){return e(a,"fetch","fail")})},d=Date.now(),d>f?(f=d+g,setTimeout(c,100)):(setTimeout(c,f-d),f+=g)},e.registerNeighbor=function(a){var b;if(null==e.sites[a])return b={},e.sites[a]=b,h(a,b),$("body").trigger("new-neighbor",a)},e.listNeighbors=function(){return d.keys(e.sites)},e.search=function(a){var b,c,f,g,h,j,k,l,m,n;b=[],m={},n=function(a){return null!=m[a]?m[a]++:m[a]=1},c=function(b,c){var d;return d=null!=c&&c.toLowerCase().indexOf(a.toLowerCase())>=0,d&&n(b),d},l=Date.now(),j=e.sites;for(h in j)i.call(j,h)&&(g=j[h],k=g.sitemap,null!=k&&n("sites"),f=d.each(k,function(a){return n("pages"),c("title",a.title)||c("text",a.synopsis)||c("slug",a.slug)?(n("finds"),b.push({page:a,site:h,rank:1})):void 0}));return m.msec=Date.now()-l,{finds:b,tally:m}}},{underscore:39}],19:[function(a,b,c){var d,e,f,g,h,i;g=a("./link"),h=null,i=0,e=function(a){return'<span class="neighbor" data-site="'+a+'">\n  <div class="wait">\n    <img src="http://'+a+'/favicon.png" title="'+a+'">\n  </div>\n</span>'},f=function(a){return h=a.sites},d=function(){var a;return a=$(".neighborhood"),$("body").on("new-neighbor",function(b,c){return a.append(e(c))}).on("new-neighbor-done",function(a,b){var c,d;return d=h[b].sitemap.length,c=$('.neighborhood .neighbor[data-site="'+b+'"]').find("img"),c.attr("title",b+"\n "+d+" pages"),i+=d,$(".searchbox .pages").text(i+" pages")}).delegate(".neighbor img","click",function(a){return g.doInternalLink("welcome-visitors",null,this.title.split("\n")[0])})},b.exports={inject:f,bind:d}},{"./link":17}],20:[function(a,b,c){var d,e,f,g,h,i,j,k,l;g=a("./util").formatDate,k=a("./random"),l=a("./revision"),e=a("underscore"),d=a("events").EventEmitter,j=new d,f=function(a){return a.replace(/\s/g,"-").replace(/[^A-Za-z0-9-]/g,"").toLowerCase()},i=function(a){return[{symbol:"❄",date:a-316224e5,period:"a Year"},{symbol:"⚘",date:a-80352e5,period:"a Season"},{symbol:"⚪",date:a-26784e5,period:"a Month"},{symbol:"☽",date:a-6048e5,period:"a Week"},{symbol:"☀",date:a-864e5,period:"a Day"},{symbol:"⌚",date:a-36e5,period:"an Hour"}]},h=function(a,b){var c,d,j,m,n,o,p,q,r,s,t,u,v,w,x,y,z,A,B,C,D,E,F,G;return C=a||{},C.title||(C.title="empty"),C.story||(C.story=[]),C.journal||(C.journal=[]),q=function(){return C},n=function(){var a,c,d,f,g,h;for(d=["view"],z()&&d.push(b),c=function(a){return null==a||e.include(d,a)?void 0:d.push(a)},h=C.journal.slice(0).reverse(),f=0,g=h.length;g>f;f++)a=h[f],c(null!=a?a.site:void 0);return d},y=function(){return null!=C.plugin},z=function(){return!(void 0===b||null===b||"view"===b||"origin"===b||"local"===b)},x=function(){return"local"===b},r=function(a){return null==a&&(a=null),z()?b:a},s=function(a){var b;return null==a&&(a=null),b=[],(a||z())&&b.push(r(a)),y()&&b.push(C.plugin+" plugin"),b.join("\n")},u=function(){return f(C.title)},p=function(a){var c,d,f,g,h,i,j,k,l;for(j=[],z()?j.push(b):null!=a&&j.push(a),k=C.story,f=0,h=k.length;h>f;f++)d=k[f],null!=(null!=d?d.site:void 0)&&j.push(d.site);for(l=C.journal,g=0,i=l.length;i>g;g++)c=l[g],null!=(null!=c?c.site:void 0)&&j.push(c.site);return e.uniq(j)},w=function(){return C.title},F=function(a){return C.title=a},t=function(){return C.journal.length-1},v=function(){var a;return a=C.journal[t()],null!=a?null!=a.date?g(a.date):"Revision "+t():"Unrecorded Date"},c=function(a){return a=e.extend({},{id:k.itemId()},a),C.story.push(a)},o=function(a){var b,c,d,e;for(e=C.story,c=0,d=e.length;d>c;c++)if(b=e[c],b.id===a)return b;return null},E=function(a){var b;return(b=function(c){return c>=C.story.length?void 0:a(C.story[c]||{text:"null"},function(){return b(c+1)})})(0)},d=function(a){var b;return b="paragraph",c({type:b,text:a})},D=function(a){var b,c,d;return d=0,c=i((new Date).getTime()),(b=function(e){var f,g,h,i,j,k;if(!(e>=C.journal.length)){for(f=C.journal[e]||{},g=f.date||0,k=null,h=0,i=c.length;i>h;h++)j=c[h],j.date>d&&j.date<g&&(k=j);return d=g,a({action:f,separator:k},function(){return b(e+1)})}})(0)},m=function(a){return C.story=(null!=a?a.getRawPage().story:void 0)||[]},G=function(){var a,c;return c=u(),a="welcome-visitors"===c?"view/welcome-visitors":"view/welcome-visitors/view/"+c,z()?"//"+b+"/"+a:"/"+a},B=function(a,b){var c,d,e;for(d=0,e=a.length;e>d;d++)if(c=a[d],c.id===b.id&&c.date===b.date)return!1;return!0},A=function(a){var c,d,e,f,g;for(f=function(){var a,b,d,e;for(d=C.journal,e=[],a=0,b=d.length;b>a;a++)c=d[a],e.push(c);return e}(),g=a.getRawPage().journal,d=0,e=g.length;e>d;d++)c=g[d],B(C.journal,c)&&f.push(c);return f.push({type:"fork",site:a.getRemoteSite(),date:(new Date).getTime()}),h(l.create(999,{title:C.title,journal:f}),b)},j=function(a){return l.apply(C,a),a.site?b=null:void 0},{getRawPage:q,getContext:n,isPlugin:y,isRemote:z,isLocal:x,getRemoteSite:r,getRemoteSiteDetails:s,getSlug:u,getNeighbors:p,getTitle:w,setTitle:F,getRevision:t,getTimestamp:v,addItem:c,getItem:o,addParagraph:d,seqItems:E,seqActions:D,become:m,siteLineup:G,merge:A,apply:j}},b.exports={newPage:h,asSlug:f,pageEmitter:j}},{"./random":26,"./revision":30,"./util":36,events:38,underscore:39}],21:[function(a,b,c){var d,e,f,g,h,i,j,k,l,m,n,o,p;d=a("underscore"),p=a("./state"),o=a("./revision"),e=a("./addToJournal"),h=a("./page").newPage,m=a("./random"),g=a("./lineup"),b.exports=j={},f=function(a){return JSON.parse(JSON.stringify(a))},j.useLocalStorage=function(){return $(".login").length>0},i=function(a){var b;return(b=localStorage.getItem(a))?JSON.parse(b):void 0},n=function(a){var b,c,d,e,f,g,j,k,l;if(d=a.pageInformation,k=a.whenGotten,l=a.whenNotGotten,b=a.localContext,g=d.slug,e=d.rev,f=d.site,f?b=[]:f=b.shift(),f===window.location.host&&(f="origin"),"view"===f&&(f=null),null!=f){if("local"===f)return(c=i(d.slug))?k(h(c,"local")):l();j="origin"===f?"/"+g+".json":"http://"+f+"/"+g+".json"}else j="/"+g+".json";return $.ajax({type:"GET",dataType:"json",url:j+("?random="+m.randomBytes(4)),success:function(a){return e&&(a=o.create(e,a)),k(h(a,f))},error:function(a,c,e){var f;return 404!==a.status&&0!==a.status?(console.log("pageHandler.get error",a,a.status,c,e),f=h({title:"Trouble: Can't Get Page"},null),f.addItem({type:"html",text:"The page handler has run into problems with this   request.\n<pre class=error>"+JSON.stringify(d)+"</pre>\nThe requested url.\n<pre class=error>"+j+"</pre>\nThe server reported status.\n<pre class=error>"+a.status+"</pre>\nThe error type.\n<pre class=error>"+c+"</pre>\nThe error message.\n<pre class=error>"+e+"</pre>\nThese problems are rarely solved by reporting issues.\nThere could be additional information reported in the browser's console.log.\nMore information might be accessible by fetching the page outside of wiki.\n<a href=\""+j+'" target="_blank">try-now</a>'}),k(f)):b.length>0?n({pageInformation:d,whenGotten:k,whenNotGotten:l,localContext:b}):l()}})},j.get=function(a){var b,c,e,f;return e=a.whenGotten,f=a.whenNotGotten,c=a.pageInformation,!c.site&&(b=i(c.slug))?(c.rev&&(b=o.create(c.rev,b)),e(h(b,"local"))):(j.context.length||(j.context=["view"]),n({pageInformation:c,whenGotten:e,whenNotGotten:f,localContext:d.clone(j.context)}))},j.context=[],k=function(a,b,c){var d,f;return"create"===c.type?d={title:c.item.title,story:[],journal:[]}:(d=i(b.slug),d||(d=g.atKey(a.data("key")).getRawPage()),null==d.journal&&(d.journal=[]),null!=(f=c.fork)&&(d.journal=d.journal.concat({type:"fork",site:f,date:(new Date).getTime()}),delete c.fork)),o.apply(d,c),localStorage.setItem(b.slug,JSON.stringify(d)),e(a.find(".journal"),c),a.addClass("local")},l=function(a,b,c){var d,h;return d=f(c),h=g.atKey(a.data("key")),"fork"===c.type&&(d.item=f(h.getRawPage())),$.ajax({type:"PUT",url:"/page/"+b.slug+"/action",data:{action:JSON.stringify(d)},success:function(){return(null!=h?h.apply:void 0)&&h.apply(c),e(a.find(".journal"),c),"fork"===c.type?localStorage.removeItem(a.attr("id")):void 0},error:function(d,e,f){return c.error={type:e,msg:f,response:d.responseText},k(a,b,c)}})},j.put=function(a,b){var c,d,f;return c=function(){var b;switch(b=a.data("site")){case"origin":case"local":case"view":return null;case location.host:return null;default:return b}},f={slug:a.attr("id").split("_rev")[0],rev:a.attr("id").split("_rev")[1],site:c(),local:a.hasClass("local")},d=f.site,console.log("pageHandler.put",b,f),j.useLocalStorage()&&(null!=f.site?console.log("remote => local"):f.local||(console.log("origin => local"),b.site=d=location.host)),b.date=(new Date).getTime(),"origin"===b.site&&delete b.site,d&&(a.find("h1").prop("title",location.host),a.find("h1 img").attr("src","/favicon.png"),a.find("h1 a").attr("href","/view/welcome-visitors/view/"+f.slug).attr("target",location.host),a.data("site",null),a.removeClass("remote"),p.setUrl(),"fork"!==b.type&&(b.fork=d,e(a.find(".journal"),{type:"fork",site:d,date:b.date}))),j.useLocalStorage()||"local"===f.site?k(a,f,b):l(a,f,b)}},{"./addToJournal":4,"./lineup":15,"./page":20,"./random":26,"./revision":30,"./state":33,underscore:39}],22:[function(a,b,c){var d,e,f,g,h,i;e=a("./editor"),h=a("./resolve"),g=a("./itemz"),i=function(a){return a.match(/<(i|b|p|a|h\d|hr|br|li|img|div|span|table|blockquote)\b.*?>/i)?"html":"markdown"},f=function(a,b){var c,d,e,f,g;for(e=b.text.split(/\n\n+/),f=[],c=0,d=e.length;d>c;c++)g=e[c],g.match(/\S/)?f.push(a.append("<p>"+h.resolveLinks(g)+"</p>")):f.push(void 0);return f},d=function(a,b){return a.dblclick(function(c){
return c.shiftKey?(b.type=i(b.text),g.replaceItem(a,"paragraph",b)):e.textEditor(a,b,{append:!0})})},b.exports={emit:f,bind:d}},{"./editor":8,"./itemz":13,"./resolve":29}],23:[function(a,b,c){b.exports=function(a){var b;return $("#user-email").hide(),$("#persona-login-btn").hide(),$("#persona-logout-btn").hide(),b=function(a){return $("<div></div>").dialog({open:function(a,b){return $(".ui-dialog-titlebar-close").hide()},buttons:{Ok:function(){return $(this).dialog("close"),navigator.id.logout()}},close:function(a,b){return $(this).remove()},resizable:!1,title:"Login Failure",modal:!0}).html(a)},navigator.id.watch({loggedInUser:a,onlogin:function(a){return $.post("/persona_login",{assertion:a},function(a){var c;return a=JSON.parse(a),"okay"===a.status?window.location="/":"wrong-address"===a.status?b("<p>Sign in is currently only available for the site owner.</p>"):"failure"===a.status?(c=/domain mismatch/.test(a.reason)?"<p>It looks as if you are accessing the site using an alternative address.</p><p>Please check that you are using the correct address to access this site.</p>":"<p>Unable to log you in.</p>",b(c)):navigator.id.logout()})},onlogout:function(){return $.post("/persona_logout",function(){return window.location="/"})},onready:function(){return a?($("#persona-login-btn").hide(),$("#persona-logout-btn").show()):($("#persona-login-btn").show(),$("#persona-logout-btn").hide())}}),$("#persona-login-btn").click(function(a){return a.preventDefault(),navigator.id.request({})}),$("#persona-logout-btn").click(function(a){return a.preventDefault(),navigator.id.logout()})}},{}],24:[function(a,b,c){var d,e,f,g,h,i=[].indexOf||function(a){for(var b=0,c=this.length;c>b;b++)if(b in this&&this[b]===a)return b;return-1};b.exports=g={},e=function(a){return(""+a).replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;").replace(/'/g,"&#x27;").replace(/\//g,"&#x2F;")},d=function(a,b){return b=$.extend(b||{},{dataType:"script",cache:!0,url:a}),$.ajax(b)},h=[],f=g.getScript=function(a,b){return null==b&&(b=function(){}),i.call(h,a)>=0?b():d(a).done(function(){return h.push(a),b()}).fail(function(){return b()})},g.get=g.getPlugin=function(a,b){return window.plugins[a]?b(window.plugins[a]):f("/plugins/"+a+"/"+a+".js",function(){return window.plugins[a]?b(window.plugins[a]):f("/plugins/"+a+".js",function(){return b(window.plugins[a])})})},g["do"]=g.doPlugin=function(a,b,c){var d;return null==c&&(c=function(){}),d=function(d,f){return a.append('<div class="error">\n  '+e(b.text||"")+"\n  <button>help</button><br>\n</div>"),a.find("button").on("click",function(){return wiki.dialog(d.toString(),'<p> This "'+b.type+'" plugin won\'t show.</p>\n<li> Is it available on this server?\n<li> Is its markup correct?\n<li> Can it find necessary data?\n<li> Has network access been interrupted?\n<li> Has its code been tested?\n<p> Developers may open debugging tools and retry the plugin.</p>\n<button class="retry">retry</button>\n<p> Learn more\n  <a class="external" target="_blank" rel="nofollow"\n  href="http://plugins.fed.wiki.org/about-plugins.html"\n  title="http://plugins.fed.wiki.org/about-plugins.html">\n    About Plugins\n    <img src="/images/external-link-ltr-icon.png">\n  </a>\n</p>'),$(".retry").on("click",function(){return f.emit.length>2?f.emit(a,b,function(){return f.bind(a,b),c()}):(f.emit(a,b),f.bind(a,b),c())})})},a.data("pageElement",a.parents(".page")),a.data("item",b),g.get(b.type,function(e){var f,g;try{if(null==e)throw TypeError("Can't find plugin for '"+b.type+"'");return e.emit.length>2?e.emit(a,b,function(){return e.bind(a,b),c()}):(e.emit(a,b),e.bind(a,b),c())}catch(g){return f=g,console.log("plugin error",f),d(f,e),c()}})},g.registerPlugin=function(a,b){return window.plugins[a]=b($)}},{}],25:[function(a,b,c){window.plugins={reference:a("./reference"),factory:a("./factory"),paragraph:a("./paragraph"),image:a("./image"),future:a("./future"),importer:a("./importer")}},{"./factory":9,"./future":10,"./image":11,"./importer":12,"./paragraph":22,"./reference":27}],26:[function(a,b,c){var d,e,f;e=function(){return(256*(1+Math.random())|0).toString(16).substring(1)},f=function(a){return function(){var b,c,d;for(d=[],b=1,c=a;c>=1?c>=b:b>=c;c>=1?b++:b--)d.push(e());return d}().join("")},d=function(){return f(8)},b.exports={randomByte:e,randomBytes:f,itemId:d}},{}],27:[function(a,b,c){var d,e,f,g,h;e=a("./editor"),h=a("./resolve"),g=a("./page"),f=function(a,b){var c,d;return d=b.slug,null!=b.title&&(d||(d=g.asSlug(b.title))),d||(d="welcome-visitors"),c=b.site,h.resolveFrom(c,function(){return a.append("<p style='margin-bottom:3px;'>\n  <img class='remote'\n    src='//"+c+"/favicon.png'\n    title='"+c+"'\n    data-site=\""+c+'"\n    data-slug="'+d+'"\n  >\n  '+h.resolveLinks("[["+(b.title||d)+"]]")+"\n</p>\n<div>\n  "+h.resolveLinks(b.text)+"\n</div>")})},d=function(a,b){return a.dblclick(function(){return e.textEditor(a,b)})},b.exports={emit:f,bind:d}},{"./editor":8,"./page":20,"./resolve":29}],28:[function(a,b,c){var d,e,f,g,h,i,j,k,l,m,n,o,p,q,r,s,t,u,v,w,x,y,z,A,B,C,D,E,F,G,H,I,J,K,L;d=a("underscore"),E=a("./pageHandler"),G=a("./plugin"),L=a("./state"),B=a("./neighborhood"),f=a("./addToJournal"),e=a("./actionSymbols"),A=a("./lineup"),K=a("./resolve"),H=a("./random"),F=a("./page"),C=F.newPage,h=F.asSlug,D=F.pageEmitter,s=function(a){return $(a).length>0?$(a).data("item")||$(a).data("staticItem"):void 0},g=function(a,b,c){var d,e;return d=$.extend({},c),e=A.atKey(a.data("key")),null!=e.getItem(d.id)?(d.alias||(d.alias=d.id),d.id=H.itemId(),b.attr("data-id",d.id)):null!=d.alias&&null==e.getItem(d.alias)&&(d.id=d.alias,delete d.alias,b.attr("data-id",d.id)),d},u=function(a,b){var c,d,e,f,h,i,j,k,l,m,n,o,p,q;return e=b.item,l=s(e),h=$(this).parents(".page:first"),f=e.data("pageElement"),q=f.data("site"),d=e.parents(".page:first"),k=function(a,b){return a&&b&&a.get(0)===b.get(0)},o=!f||k(f,d),m=!o&&k(h,f),n=!o&&k(h,d),m&&(f.hasClass("ghost")||f.attr("id")===d.attr("id")||a.shiftKey)?void 0:(i=o?(p=$(this).children().map(function(a,b){return $(b).attr("data-id")}).get(),{type:"move",order:p}):m?(console.log("drag from",f.find("h1").text()),{type:"remove"}):n?(e.data("pageElement",h),c=e.prev(".item"),j=s(c),l=g(h,e,l),{type:"add",item:l,after:null!=j?j.id:void 0}):void 0,i.id=l.id,E.put(h,i))},y=function(a){var b,c;return c={connectWith:".page .story",placeholder:"item-placeholder",forcePlaceholderSize:!0},b=a.find(".story"),b.sortable(c).on("sortupdate",u)},t=function(a){var b;return b=$(a).parents(".page:first"),A.atKey(b.data("key"))},w=function(a,b){var c,d;return c=t(b.draggable),d=t(a.target),D.emit("show",d.merge(c))},z=function(a){var b;return b=a.find(".journal"),b.draggable({revert:!0,appendTo:".main",scroll:!1,helper:"clone"}),b.droppable({hoverClass:"ui-state-hover",drop:w})},x=function(a){return a.find(".add-factory").live("click",function(b){return a.hasClass("ghost")?void 0:(b.preventDefault(),j(a))})},j=function(a){var b,c,d,e;return e={type:"factory",id:H.itemId()},c=$("<div />",{"class":"item factory"}).data("item",e).attr("data-id",e.id),c.data("pageElement",a),a.find(".story").append(c),G["do"](c,e),b=c.prev(".item"),d=s(b),E.put(a,{item:e,id:e.id,type:"add",after:null!=d?d.id:void 0})},v=function(a){var b,c,d,e,f;return a.preventDefault(),A.debugSelfCheck(function(){var a,b,c,e;for(c=$(".page"),e=[],a=0,b=c.length;b>a;a++)d=c[a],e.push($(d).data("key"));return e}()),b=$(a.target).parents(".page:first"),c=A.crumbs(b.data("key"),location.host),f=c[0],e=window.open("//"+c.join("/"),f),e.focus()},p=function(a,b,c){var d,e;return d=c.getRemoteSite(location.host),e=c.getRemoteSiteDetails(location.host),a.append('<h1 title="'+e+'">\n  <a href="'+c.siteLineup()+'" target="'+d+'">\n    <img src="//'+d+'/favicon.png" height="32px" class="favicon">\n  </a> '+K.escape(c.getTitle())+"\n</h1>"),a.find("a").on("click",v)},q=function(a,b,c){return b.attr("id").match(/_rev/)?(b.addClass("ghost"),b.data("rev",c.getRevision()),a.append($('<h2 class="revision">\n  <span>\n    '+c.getTimestamp()+"\n  </span>\n</h2>"))):void 0},n=function(a){return a.append('<div class="control-buttons">\n  <a href="#" class="button fork-page" title="fork this page">'+e.fork+'</a>\n  <a href="#" class="button add-factory" title="add paragraph">'+e.add+"</a>\n</div>")},o=function(a,b){var c,d;return c=b.getRemoteSite(location.host),d=b.getSlug(),a.append('<a id="license" href="http://creativecommons.org/licenses/by-sa/4.0/">CC BY-SA 4.0</a> .\n<a class="show-page-source" href="/'+d+".json?random="+H.randomBytes(4)+'" title="source">JSON</a> .\n<a href= "//'+c+"/"+d+'.html" target="'+c+'">'+c+" </a>")},m=function(a){var b,c,d;for(d=a||[],c=d.length-1;c>=0;c+=-1)if(b=d[c],b.date&&"fork"!==b.type)return b.date;return void 0},r=function(a){var b,c,d,e,f,g,i,j,k,l,n,o,p,q,r,s,t;if(l=a.data("data"),l&&(q=a.data("site")||window.location.host,("view"===q||"origin"===q)&&(q=window.location.host),r=h(l.title),t=m(l.journal))){c={newer:[],same:[],older:[]},n=B.sites;for(p in n)if(f=n[p],p!==q&&null!=f.sitemap)for(o=f.sitemap,i=0,k=o.length;k>i;i++)g=o[i],g.slug===r&&(b=g.date>t?c.newer:g.date<t?c.older:c.same,b.push({remoteSite:p,item:g}));s=[];for(j in c)b=c[j],b.length&&(b.sort(function(a,b){return a.item.date<b.item.date}),d=function(){var a,c,d,f;for(f=[],e=a=0,c=b.length;c>a&&(d=b[e],p=d.remoteSite,g=d.item,!(e>=8));e=++a)f.push('<img class="remote"\nsrc="http://'+p+'/favicon.png"\ndata-slug="'+r+'"\ndata-site="'+p+'"\ntitle="'+p+'">');return f}(),s.push(d.join("&nbsp;")+" "+j));if(s)return a.find(".twins").html("<p>"+s.join(", ")+"</p>")}},J=function(a,b){var c,d,e,g,h,i,j;return b.data("data",a.getRawPage()),a.isRemote()&&b.data("site",a.getRemoteSite()),console.log(".page keys ",function(){var a,b,c,d;for(c=$(".page"),d=[],a=0,b=c.length;b>a;a++)i=c[a],d.push($(i).data("key"));return d}()),console.log("lineup keys",A.debugKeys()),K.resolutionContext=a.getContext(),b.empty(),j=["twins","header","story","journal","footer"].map(function(a){return $("<div />").addClass(a).appendTo(b)}),h=j[0],d=j[1],g=j[2],e=j[3],c=j[4],p(d,b,a),q(d,b,a),a.seqItems(function(a,b){var c;return c=$('<div class="item '+a.type+'" data-id="'+a.id+'">'),g.append(c),G["do"](c,a,b)}),a.seqActions(function(a,b){return a.separator&&f(e,a.separator),f(e,a.action),b()}),r(b),n(e),o(c,a)},k=function(a,b){return b.isRemote()?void 0:$("img.favicon",a).error(function(){return G.get("favicon",function(a){return a.create()})})},I=function(a,b){return a.isLocal()&&b.addClass("local"),a.isRemote()&&b.addClass("remote"),a.isPlugin()&&b.addClass("plugin"),J(a,b),k(b,a),L.setUrl(),y(b),z(b),x(b),b},i=function(a,b){return b.data("key",A.addPage(a)),I(a,b)},l=function(){var a,b,c,e,f,g,h;return a=$(this),e=a.attr("id").split("_rev"),g=e[0],f=e[1],c={slug:g,rev:f,site:a.data("site")},b=function(){var b,c,e,f,h,j,k,l,m,n;n=$('a[href="/'+g+'.html"]:last').text()||g,j=C(),j.setTitle(n),c=[],k=B.sites;for(m in k)e=k[m],null!=e.sitemap&&(l=d.find(e.sitemap,function(a){return a.slug===g}),null!=l&&c.push({type:"reference",site:m,slug:g,title:l.title||g,text:l.synopsis||""}));if(c.length>0)for(j.addItem({type:"future",text:"We could not find this page in the expected context.",title:n}),j.addItem({type:"paragraph",text:"We did find the page in your current neighborhood."}),f=0,h=c.length;h>f;f++)b=c[f],j.addItem(b);else j.addItem({type:"future",text:"We could not find this page.",title:n});return i(j,a).addClass("ghost")},h=function(b){var c,d,e,f,g;for(i(b,a),e=b.getNeighbors(location.host),f=[],c=0,d=e.length;d>c;c++)g=e[c],f.push(B.registerNeighbor(g));return f},E.get({whenGotten:h,whenNotGotten:b,pageInformation:c})},b.exports={cycle:l,emitTwins:r,buildPage:i,rebuildPage:I}},{"./actionSymbols":2,"./addToJournal":4,"./lineup":15,"./neighborhood":18,"./page":20,"./pageHandler":21,"./plugin":24,"./random":26,"./resolve":29,"./state":33,underscore:39}],29:[function(a,b,c){var d,e,f;d=a("./page").asSlug,b.exports=f={},f.resolutionContext=[],f.escape=e=function(a){return a.replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;")},f.resolveFrom=function(a,b){f.resolutionContext.push(a);try{return b()}finally{f.resolutionContext.pop()}},f.resolveLinks=function(a,b){var c,g,h,i,j;return null==b&&(b=e),i=[],h=function(a){var b;return b=i.length,i.push(a),"〖"+b+"〗"},j=function(a,b){return i[+b]},g=function(a,b){var c,g;return c=-1===b.indexOf("|")?b:b.split("|")[1],g=d(b.split("|")[0]),h("http"===b.slice(0,4)?'<a class="internal" href="/'+g+'.html" data-page-name="'+g+'" title="'+f.resolutionContext.join(" => ")+'" style="color: rgb(227,150,50)">'+e(c)+"</a>":'<a class="internal" href="/'+g+'.html" data-page-name="'+g+'" title="'+f.resolutionContext.join(" => ")+'">'+e(c)+"</a>")},c=function(a,b,c,d){return h('<a class="external" target="_blank" href="'+b+'" title="'+b+'" style="color: rgb(222,35,91)" rel="nofollow">'+e(d)+' <img src="/images/external-link-ltr-icon.png"></a>')},a=a.replace(/〖(\d+)〗/g,"〖 $1 〗").replace(/\[\[([^\]]+)\]\]/gi,g).replace(/\[((http|https|ftp):.*?) (.*?)\]/gi,c),b(a).replace(/〖(\d+)〗/g,j)}},{"./page":20}],30:[function(a,b,c){var d,e;d=function(a,b){var c,d,e,f,g,h;switch(g=function(){var b,c,d,e,f;for(e=a.story||[],f=[],b=0,d=e.length;d>b;b++)c=e[b],f.push(null!=c?c.id:void 0);return f},c=function(b,c){var d;return d=g().indexOf(b)+1,a.story.splice(d,0,c)},h=function(){var c;return-1!==(c=g().indexOf(b.id))?a.story.splice(c,1):void 0},a.story||(a.story=[]),b.type){case"create":null!=b.item&&(null!=b.item.title&&(a.title=b.item.title),null!=b.item.story&&(a.story=b.item.story.slice()));break;case"add":c(b.after,b.item);break;case"edit":-1!==(e=g().indexOf(b.id))?a.story.splice(e,1,b.item):a.story.push(b.item);break;case"move":e=b.order.indexOf(b.id),d=b.order[e-1],f=a.story[g().indexOf(b.id)],h(),c(d,f);break;case"remove":h()}return a.journal||(a.journal=[]),a.journal.push(b)},e=function(a,b){var c,e,f,g,h;for(a=+a,g=b.journal.slice(0,+a+1||9e9),h={title:b.title,story:[]},e=0,f=g.length;f>e;e++)c=g[e],d(h,c||{});return h},b.exports={create:e,apply:d}},{}],31:[function(a,b,c){var d,e,f,g;f=a("./link"),d=a("./active"),g=a("./page").newPage,e=function(a){var b,c;return b=a.neighborhood,c=function(a){var c,d,e,h,i,j,k;for(j=b.search(a),k=j.tally,i=g(),i.setTitle("Search for '"+a+"'"),i.addParagraph("String '"+a+"' found on "+(k.finds||"none")+" of "+(k.pages||"no")+" pages from "+(k.sites||"no")+" sites.\nText matched on "+(k.title||"no")+" titles, "+(k.text||"no")+" paragraphs, and "+(k.slug||"no")+" slugs.\nElapsed time "+k.msec+" milliseconds."),e=j.finds,c=0,d=e.length;d>c;c++)h=e[c],i.addItem({type:"reference",site:h.site,slug:h.page.slug,title:h.page.title,text:h.page.synopsis||""});return f.showResult(i)},{performSearch:c}},b.exports=e},{"./active":3,"./link":17,"./page":20}],32:[function(a,b,c){var d,e,f,g;e=a("./search"),g=null,f=function(a){return g=e({neighborhood:a})},d=function(){return $("input.search").on("keypress",function(a){var b;if(13===a.keyCode)return b=$(this).val(),g.performSearch(b),$(this).val("")})},b.exports={inject:f,bind:d}},{"./search":31}],33:[function(a,b,c){var d,e,f,g,h=[].indexOf||function(a){for(var b=0,c=this.length;c>b;b++)if(b in this&&this[b]===a)return b;return-1};d=a("./active"),e=a("./lineup"),f=null,b.exports=g={},g.inject=function(a){return f=a},g.pagesInDom=function(){return $.makeArray($(".page").map(function(a,b){return b.id}))},g.urlPages=function(){var a;return function(){var b,c,d,e;for(d=$(location).attr("pathname").split("/"),e=[],b=0,c=d.length;c>b;b+=2)a=d[b],e.push(a);return e}().slice(1)},g.locsInDom=function(){return $.makeArray($(".page").map(function(a,b){return $(b).data("site")||"view"}))},g.urlLocs=function(){var a,b,c,d,e;for(d=$(location).attr("pathname").split("/").slice(1),e=[],b=0,c=d.length;c>b;b+=2)a=d[b],e.push(a);return e},g.setUrl=function(){var a,b,c,d,f;return document.title=e.bestTitle(),history&&history.pushState&&(b=g.locsInDom(),d=g.pagesInDom(),f=function(){var e,f,g;for(g=[],a=e=0,f=d.length;f>e;a=++e)c=d[a],g.push("/"+((null!=b?b[a]:void 0)||"view")+"/"+c);return g}().join(""),f!==$(location).attr("pathname"))?history.pushState(null,null,f):void 0},g.show=function(a){var b,c,h,i,j,k,l,m,n,o,p,q,r;if(r=g.pagesInDom(),o=g.urlPages(),q=g.locsInDom(),n=g.urlLocs(),location.pathname&&"/"!==location.pathname){for(l=!0,c=h=0,j=r.length;j>h;c=++h)m=r[c],l&&(l=m===o[c])||(p=$(".page:last"),e.removeKey(p.data("key")),p.remove());for(l=!0,c=i=0,k=o.length;k>i;c=++i)m=o[c],l&&(l=m===r[c])||(console.log("push",c,m),f.showPage(m,n[c]));return console.log("a .page keys ",function(){var a,c,d,e;for(d=$(".page"),e=[],c=0,a=d.length;a>c;c++)b=d[c],e.push($(b).data("key"));return e}()),console.log("a lineup keys",e.debugKeys()),d.set($(".page").last()),document.title=e.bestTitle()}},g.first=function(){var a,b,c,d,e,i,j,k;for(g.setUrl(),b=g.urlPages(),a=g.urlLocs(),i=g.pagesInDom(),j=[],c=d=0,e=b.length;e>d;c=++d)k=b[c],h.call(i,k)<0&&(""!==k?j.push(f.createPage(k,a[c])):j.push(void 0));return j}},{"./active":3,"./lineup":15}],34:[function(a,b,c){b.exports=function(a){var b,c,d;return d=a.synopsis,null!=a&&null!=a.story?(b=a.story[0],c=a.story[1],b&&"paragraph"===b.type&&(d||(d=b.text)),c&&"paragraph"===c.type&&(d||(d=c.text)),b&&null!=b.text&&(d||(d=b.text)),c&&null!=c.text&&(d||(d=c.text)),d||(d=null!=a.story&&"A page with "+a.story.length+" items.")):d="A page with no story.",d}},{}],35:[function(a,b,c){var d,e,f,g,h,i,j,k,l,m,n;n=!1,i=null,d=null,f=function(){return $(document).keydown(function(a){return 16===a.keyCode?l(a):void 0}).keyup(function(a){return 16===a.keyCode?m(a):void 0}),$(".main").delegate(".item","mouseenter",h).delegate(".item","mouseleave",k).delegate(".action","mouseenter",g).delegate(".action","mouseleave",j).delegate(".page","align-item",e)},l=function(a){var b;return n=a.shiftKey,n&&(b=i||d)?$("[data-id="+b+"]").addClass("target"):void 0},m=function(a){return n=a.shiftKey,n?void 0:$(".item, .action").removeClass("target")},h=function(a){var b,c,d,e;return i=(b=$(this)).attr("data-id"),n?($("[data-id="+i+"]").addClass("target"),d=(c=$(this).parents(".page:first")).data("key"),e=b.offset().top,$(".page").trigger("align-item",{key:d,id:i,place:e})):void 0},k=function(a){return n&&$(".item, .action").removeClass("target"),i=null},g=function(a){var b;return d=$(this).data("id"),n?($("[data-id="+d+"]").addClass("target"),b=$(this).parents(".page:first").data("key"),$(".page").trigger("align-item",{key:b,id:d})):void 0},j=function(a){return n&&$("[data-id="+d+"]").removeClass("target"),d=null},e=function(a,b){var c,d,e,f;return d=$(this),d.data("key")!==b.key&&(c=d.find(".item[data-id="+b.id+"]"),c.length)?(f=b.place||d.height()/2,e=c.offset().top+d.scrollTop()-f,d.stop().animate({scrollTop:e},"slow")):void 0},b.exports={bind:f}},{}],36:[function(a,b,c){var d;b.exports=d={},d.formatTime=function(a){var b,c,d,e,f;return c=new Date(a>1e10?a:1e3*a),f=["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"][c.getMonth()],d=c.getHours(),b=12>d?"AM":"PM",d=0===d?12:d>12?d-12:d,e=(c.getMinutes()<10?"0":"")+c.getMinutes(),d+":"+e+" "+b+"<br>"+c.getDate()+" "+f+" "+c.getFullYear()},d.formatDate=function(a){var b,c,d,e,f,g,h,i,j;return c=new Date(a),i=["Sun","Mon","Tue","Wed","Thu","Fri","Sat"][c.getDay()],g=["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"][c.getMonth()],d=c.getDate(),j=c.getFullYear(),e=c.getHours(),b=12>e?"AM":"PM",e=0===e?12:e>12?e-12:e,f=(c.getMinutes()<10?"0":"")+c.getMinutes(),h=(c.getSeconds()<10?"0":"")+c.getSeconds(),i+" "+g+" "+d+", "+j+"<br>"+e+":"+f+":"+h+" "+b},d.formatElapsedTime=function(a){var b,c,d,e,f,g,h,i;return f=(new Date).getTime()-a,(g=f/1e3)<2?Math.floor(f)+" milliseconds ago":(d=g/60)<2?Math.floor(g)+" seconds ago":(c=d/60)<2?Math.floor(d)+" minutes ago":(b=c/24)<2?Math.floor(c)+" hours ago":(h=b/7)<2?Math.floor(b)+" days ago":(e=b/31)<2?Math.floor(h)+" weeks ago":(i=b/365)<2?Math.floor(e)+" months ago":Math.floor(i)+" years ago"}},{}],37:[function(a,b,c){var d,e,f,g,h,i,j,k,l,m=[].slice;l={},l.asSlug=a("./page").asSlug,l.newPage=a("./page").newPage,f=a("./itemz"),l.removeItem=f.removeItem,l.createItem=f.createItem,l.getItem=f.getItem,d=a("./dialog"),l.dialog=d.open,g=a("./link"),l.createPage=g.createPage,l.doInternalLink=g.doInternalLink,l.showResult=g.showResult,j=a("./plugin"),l.getScript=j.getScript,l.getPlugin=j.getPlugin,l.doPlugin=j.doPlugin,l.registerPlugin=j.registerPlugin,l.getData=function(a){var b,c;return a?(b=$(".item").index(a),c=$(".item:lt("+b+")").filter(".chart,.data,.calculator").last(),null!=c?c.data("item").data:{}):(c=$(".chart,.data,.calculator").last(),null!=c?c.data("item").data:{})},l.getDataNodes=function(a){var b,c;return a?(b=$(".item").index(a),c=$(".item:lt("+b+")").filter(".chart,.data,.calculator").toArray().reverse(),$(c)):(c=$(".chart,.data,.calculator").toArray().reverse(),$(c))},l.log=function(){var a;return a=1<=arguments.length?m.call(arguments,0):[],null!=("undefined"!=typeof console&&null!==console?console.log:void 0)?console.log.apply(console,a):void 0},h=a("./neighborhood"),l.neighborhood=h.sites,l.neighborhoodObject=h,i=a("./pageHandler"),l.pageHandler=i,l.useLocalStorage=i.useLocalStorage,k=a("./resolve"),l.resolveFrom=k.resolveFrom,l.resolveLinks=k.resolveLinks,l.resolutionContext=k.resolutionContext,e=a("./editor"),l.textEditor=e.textEditor,l.util=a("./util"),l.persona=a("./persona"),l.createSynopsis=a("./synopsis"),b.exports=l},{"./dialog":6,"./editor":8,"./itemz":13,"./link":17,"./neighborhood":18,"./page":20,"./pageHandler":21,"./persona":23,"./plugin":24,"./resolve":29,"./synopsis":34,"./util":36}],38:[function(a,b,c){function d(){this._events=this._events||{},this._maxListeners=this._maxListeners||void 0}function e(a){return"function"==typeof a}function f(a){return"number"==typeof a}function g(a){return"object"==typeof a&&null!==a}function h(a){return void 0===a}b.exports=d,d.EventEmitter=d,d.prototype._events=void 0,d.prototype._maxListeners=void 0,d.defaultMaxListeners=10,d.prototype.setMaxListeners=function(a){if(!f(a)||0>a||isNaN(a))throw TypeError("n must be a positive number");return this._maxListeners=a,this},d.prototype.emit=function(a){var b,c,d,f,i,j;if(this._events||(this._events={}),"error"===a&&(!this._events.error||g(this._events.error)&&!this._events.error.length)){if(b=arguments[1],b instanceof Error)throw b;throw TypeError('Uncaught, unspecified "error" event.')}if(c=this._events[a],h(c))return!1;if(e(c))switch(arguments.length){case 1:c.call(this);break;case 2:c.call(this,arguments[1]);break;case 3:c.call(this,arguments[1],arguments[2]);break;default:for(d=arguments.length,f=new Array(d-1),i=1;d>i;i++)f[i-1]=arguments[i];c.apply(this,f)}else if(g(c)){for(d=arguments.length,f=new Array(d-1),i=1;d>i;i++)f[i-1]=arguments[i];for(j=c.slice(),d=j.length,i=0;d>i;i++)j[i].apply(this,f)}return!0},d.prototype.addListener=function(a,b){var c;if(!e(b))throw TypeError("listener must be a function");if(this._events||(this._events={}),this._events.newListener&&this.emit("newListener",a,e(b.listener)?b.listener:b),this._events[a]?g(this._events[a])?this._events[a].push(b):this._events[a]=[this._events[a],b]:this._events[a]=b,g(this._events[a])&&!this._events[a].warned){var c;c=h(this._maxListeners)?d.defaultMaxListeners:this._maxListeners,c&&c>0&&this._events[a].length>c&&(this._events[a].warned=!0,console.error("(node) warning: possible EventEmitter memory leak detected. %d listeners added. Use emitter.setMaxListeners() to increase limit.",this._events[a].length),"function"==typeof console.trace&&console.trace())}return this},d.prototype.on=d.prototype.addListener,d.prototype.once=function(a,b){function c(){this.removeListener(a,c),d||(d=!0,b.apply(this,arguments))}if(!e(b))throw TypeError("listener must be a function");var d=!1;return c.listener=b,this.on(a,c),this},d.prototype.removeListener=function(a,b){var c,d,f,h;if(!e(b))throw TypeError("listener must be a function");if(!this._events||!this._events[a])return this;if(c=this._events[a],f=c.length,d=-1,c===b||e(c.listener)&&c.listener===b)delete this._events[a],this._events.removeListener&&this.emit("removeListener",a,b);else if(g(c)){for(h=f;h-->0;)if(c[h]===b||c[h].listener&&c[h].listener===b){d=h;break}if(0>d)return this;1===c.length?(c.length=0,delete this._events[a]):c.splice(d,1),this._events.removeListener&&this.emit("removeListener",a,b)}return this},d.prototype.removeAllListeners=function(a){var b,c;if(!this._events)return this;if(!this._events.removeListener)return 0===arguments.length?this._events={}:this._events[a]&&delete this._events[a],this;if(0===arguments.length){for(b in this._events)"removeListener"!==b&&this.removeAllListeners(b);return this.removeAllListeners("removeListener"),this._events={},this}if(c=this._events[a],e(c))this.removeListener(a,c);else for(;c.length;)this.removeListener(a,c[c.length-1]);return delete this._events[a],this},d.prototype.listeners=function(a){var b;return b=this._events&&this._events[a]?e(this._events[a])?[this._events[a]]:this._events[a].slice():[]},d.listenerCount=function(a,b){var c;return c=a._events&&a._events[b]?e(a._events[b])?1:a._events[b].length:0}},{}],39:[function(a,b,c){(function(){function a(a){function b(b,c,d,e,f,g){for(;f>=0&&g>f;f+=a){var h=e?e[f]:f;d=c(d,b[h],h,b)}return d}return function(c,d,e,f){d=v(d,f,4);var g=!C(c)&&u.keys(c),h=(g||c).length,i=a>0?0:h-1;return arguments.length<3&&(e=c[g?g[i]:i],i+=a),b(c,d,e,g,i,h)}}function d(a){return function(b,c,d){c=w(c,d);for(var e=B(b),f=a>0?0:e-1;f>=0&&e>f;f+=a)if(c(b[f],f,b))return f;return-1}}function e(a,b,c){return function(d,e,f){var g=0,h=B(d);if("number"==typeof f)a>0?g=f>=0?f:Math.max(f+h,g):h=f>=0?Math.min(f+1,h):f+h+1;else if(c&&f&&h)return f=c(d,e),d[f]===e?f:-1;if(e!==e)return f=b(m.call(d,g,h),u.isNaN),f>=0?f+g:-1;for(f=a>0?g:h-1;f>=0&&h>f;f+=a)if(d[f]===e)return f;return-1}}function f(a,b){var c=H.length,d=a.constructor,e=u.isFunction(d)&&d.prototype||j,f="constructor";for(u.has(a,f)&&!u.contains(b,f)&&b.push(f);c--;)f=H[c],f in a&&a[f]!==e[f]&&!u.contains(b,f)&&b.push(f)}var g=this,h=g._,i=Array.prototype,j=Object.prototype,k=Function.prototype,l=i.push,m=i.slice,n=j.toString,o=j.hasOwnProperty,p=Array.isArray,q=Object.keys,r=k.bind,s=Object.create,t=function(){},u=function(a){return a instanceof u?a:this instanceof u?void(this._wrapped=a):new u(a)};"undefined"!=typeof c?("undefined"!=typeof b&&b.exports&&(c=b.exports=u),c._=u):g._=u,u.VERSION="1.8.3";var v=function(a,b,c){if(void 0===b)return a;switch(null==c?3:c){case 1:return function(c){return a.call(b,c)};case 2:return function(c,d){return a.call(b,c,d)};case 3:return function(c,d,e){return a.call(b,c,d,e)};case 4:return function(c,d,e,f){return a.call(b,c,d,e,f)}}return function(){return a.apply(b,arguments)}},w=function(a,b,c){return null==a?u.identity:u.isFunction(a)?v(a,b,c):u.isObject(a)?u.matcher(a):u.property(a)};u.iteratee=function(a,b){return w(a,b,1/0)};var x=function(a,b){return function(c){var d=arguments.length;if(2>d||null==c)return c;for(var e=1;d>e;e++)for(var f=arguments[e],g=a(f),h=g.length,i=0;h>i;i++){var j=g[i];b&&void 0!==c[j]||(c[j]=f[j])}return c}},y=function(a){if(!u.isObject(a))return{};if(s)return s(a);t.prototype=a;var b=new t;return t.prototype=null,b},z=function(a){return function(b){return null==b?void 0:b[a]}},A=Math.pow(2,53)-1,B=z("length"),C=function(a){var b=B(a);return"number"==typeof b&&b>=0&&A>=b};u.each=u.forEach=function(a,b,c){b=v(b,c);var d,e;if(C(a))for(d=0,e=a.length;e>d;d++)b(a[d],d,a);else{var f=u.keys(a);for(d=0,e=f.length;e>d;d++)b(a[f[d]],f[d],a)}return a},u.map=u.collect=function(a,b,c){b=w(b,c);for(var d=!C(a)&&u.keys(a),e=(d||a).length,f=Array(e),g=0;e>g;g++){var h=d?d[g]:g;f[g]=b(a[h],h,a)}return f},u.reduce=u.foldl=u.inject=a(1),u.reduceRight=u.foldr=a(-1),u.find=u.detect=function(a,b,c){var d;return d=C(a)?u.findIndex(a,b,c):u.findKey(a,b,c),void 0!==d&&-1!==d?a[d]:void 0},u.filter=u.select=function(a,b,c){var d=[];return b=w(b,c),u.each(a,function(a,c,e){b(a,c,e)&&d.push(a)}),d},u.reject=function(a,b,c){return u.filter(a,u.negate(w(b)),c)},u.every=u.all=function(a,b,c){b=w(b,c);for(var d=!C(a)&&u.keys(a),e=(d||a).length,f=0;e>f;f++){var g=d?d[f]:f;if(!b(a[g],g,a))return!1}return!0},u.some=u.any=function(a,b,c){b=w(b,c);for(var d=!C(a)&&u.keys(a),e=(d||a).length,f=0;e>f;f++){var g=d?d[f]:f;if(b(a[g],g,a))return!0}return!1},u.contains=u.includes=u.include=function(a,b,c,d){return C(a)||(a=u.values(a)),("number"!=typeof c||d)&&(c=0),u.indexOf(a,b,c)>=0},u.invoke=function(a,b){var c=m.call(arguments,2),d=u.isFunction(b);return u.map(a,function(a){var e=d?b:a[b];return null==e?e:e.apply(a,c)})},u.pluck=function(a,b){return u.map(a,u.property(b))},u.where=function(a,b){return u.filter(a,u.matcher(b))},u.findWhere=function(a,b){return u.find(a,u.matcher(b))},u.max=function(a,b,c){var d,e,f=-(1/0),g=-(1/0);if(null==b&&null!=a){a=C(a)?a:u.values(a);for(var h=0,i=a.length;i>h;h++)d=a[h],d>f&&(f=d)}else b=w(b,c),u.each(a,function(a,c,d){e=b(a,c,d),(e>g||e===-(1/0)&&f===-(1/0))&&(f=a,g=e)});return f},u.min=function(a,b,c){var d,e,f=1/0,g=1/0;if(null==b&&null!=a){a=C(a)?a:u.values(a);for(var h=0,i=a.length;i>h;h++)d=a[h],f>d&&(f=d)}else b=w(b,c),u.each(a,function(a,c,d){e=b(a,c,d),(g>e||e===1/0&&f===1/0)&&(f=a,g=e)});return f},u.shuffle=function(a){for(var b,c=C(a)?a:u.values(a),d=c.length,e=Array(d),f=0;d>f;f++)b=u.random(0,f),b!==f&&(e[f]=e[b]),e[b]=c[f];return e},u.sample=function(a,b,c){return null==b||c?(C(a)||(a=u.values(a)),a[u.random(a.length-1)]):u.shuffle(a).slice(0,Math.max(0,b))},u.sortBy=function(a,b,c){return b=w(b,c),u.pluck(u.map(a,function(a,c,d){return{value:a,index:c,criteria:b(a,c,d)}}).sort(function(a,b){var c=a.criteria,d=b.criteria;if(c!==d){if(c>d||void 0===c)return 1;if(d>c||void 0===d)return-1}return a.index-b.index}),"value")};var D=function(a){return function(b,c,d){var e={};return c=w(c,d),u.each(b,function(d,f){var g=c(d,f,b);a(e,d,g)}),e}};u.groupBy=D(function(a,b,c){u.has(a,c)?a[c].push(b):a[c]=[b]}),u.indexBy=D(function(a,b,c){a[c]=b}),u.countBy=D(function(a,b,c){u.has(a,c)?a[c]++:a[c]=1}),u.toArray=function(a){return a?u.isArray(a)?m.call(a):C(a)?u.map(a,u.identity):u.values(a):[]},u.size=function(a){return null==a?0:C(a)?a.length:u.keys(a).length},u.partition=function(a,b,c){b=w(b,c);var d=[],e=[];return u.each(a,function(a,c,f){(b(a,c,f)?d:e).push(a)}),[d,e]},u.first=u.head=u.take=function(a,b,c){return null==a?void 0:null==b||c?a[0]:u.initial(a,a.length-b)},u.initial=function(a,b,c){return m.call(a,0,Math.max(0,a.length-(null==b||c?1:b)))},u.last=function(a,b,c){return null==a?void 0:null==b||c?a[a.length-1]:u.rest(a,Math.max(0,a.length-b))},u.rest=u.tail=u.drop=function(a,b,c){return m.call(a,null==b||c?1:b)},u.compact=function(a){return u.filter(a,u.identity)};var E=function(a,b,c,d){for(var e=[],f=0,g=d||0,h=B(a);h>g;g++){var i=a[g];if(C(i)&&(u.isArray(i)||u.isArguments(i))){b||(i=E(i,b,c));var j=0,k=i.length;for(e.length+=k;k>j;)e[f++]=i[j++]}else c||(e[f++]=i)}return e};u.flatten=function(a,b){return E(a,b,!1)},u.without=function(a){return u.difference(a,m.call(arguments,1))},u.uniq=u.unique=function(a,b,c,d){u.isBoolean(b)||(d=c,c=b,b=!1),null!=c&&(c=w(c,d));for(var e=[],f=[],g=0,h=B(a);h>g;g++){var i=a[g],j=c?c(i,g,a):i;b?(g&&f===j||e.push(i),f=j):c?u.contains(f,j)||(f.push(j),e.push(i)):u.contains(e,i)||e.push(i)}return e},u.union=function(){return u.uniq(E(arguments,!0,!0))},u.intersection=function(a){for(var b=[],c=arguments.length,d=0,e=B(a);e>d;d++){var f=a[d];if(!u.contains(b,f)){for(var g=1;c>g&&u.contains(arguments[g],f);g++);g===c&&b.push(f)}}return b},u.difference=function(a){var b=E(arguments,!0,!0,1);return u.filter(a,function(a){return!u.contains(b,a)})},u.zip=function(){return u.unzip(arguments)},u.unzip=function(a){for(var b=a&&u.max(a,B).length||0,c=Array(b),d=0;b>d;d++)c[d]=u.pluck(a,d);return c},u.object=function(a,b){for(var c={},d=0,e=B(a);e>d;d++)b?c[a[d]]=b[d]:c[a[d][0]]=a[d][1];
return c},u.findIndex=d(1),u.findLastIndex=d(-1),u.sortedIndex=function(a,b,c,d){c=w(c,d,1);for(var e=c(b),f=0,g=B(a);g>f;){var h=Math.floor((f+g)/2);c(a[h])<e?f=h+1:g=h}return f},u.indexOf=e(1,u.findIndex,u.sortedIndex),u.lastIndexOf=e(-1,u.findLastIndex),u.range=function(a,b,c){null==b&&(b=a||0,a=0),c=c||1;for(var d=Math.max(Math.ceil((b-a)/c),0),e=Array(d),f=0;d>f;f++,a+=c)e[f]=a;return e};var F=function(a,b,c,d,e){if(!(d instanceof b))return a.apply(c,e);var f=y(a.prototype),g=a.apply(f,e);return u.isObject(g)?g:f};u.bind=function(a,b){if(r&&a.bind===r)return r.apply(a,m.call(arguments,1));if(!u.isFunction(a))throw new TypeError("Bind must be called on a function");var c=m.call(arguments,2),d=function(){return F(a,d,b,this,c.concat(m.call(arguments)))};return d},u.partial=function(a){var b=m.call(arguments,1),c=function(){for(var d=0,e=b.length,f=Array(e),g=0;e>g;g++)f[g]=b[g]===u?arguments[d++]:b[g];for(;d<arguments.length;)f.push(arguments[d++]);return F(a,c,this,this,f)};return c},u.bindAll=function(a){var b,c,d=arguments.length;if(1>=d)throw new Error("bindAll must be passed function names");for(b=1;d>b;b++)c=arguments[b],a[c]=u.bind(a[c],a);return a},u.memoize=function(a,b){var c=function(d){var e=c.cache,f=""+(b?b.apply(this,arguments):d);return u.has(e,f)||(e[f]=a.apply(this,arguments)),e[f]};return c.cache={},c},u.delay=function(a,b){var c=m.call(arguments,2);return setTimeout(function(){return a.apply(null,c)},b)},u.defer=u.partial(u.delay,u,1),u.throttle=function(a,b,c){var d,e,f,g=null,h=0;c||(c={});var i=function(){h=c.leading===!1?0:u.now(),g=null,f=a.apply(d,e),g||(d=e=null)};return function(){var j=u.now();h||c.leading!==!1||(h=j);var k=b-(j-h);return d=this,e=arguments,0>=k||k>b?(g&&(clearTimeout(g),g=null),h=j,f=a.apply(d,e),g||(d=e=null)):g||c.trailing===!1||(g=setTimeout(i,k)),f}},u.debounce=function(a,b,c){var d,e,f,g,h,i=function(){var j=u.now()-g;b>j&&j>=0?d=setTimeout(i,b-j):(d=null,c||(h=a.apply(f,e),d||(f=e=null)))};return function(){f=this,e=arguments,g=u.now();var j=c&&!d;return d||(d=setTimeout(i,b)),j&&(h=a.apply(f,e),f=e=null),h}},u.wrap=function(a,b){return u.partial(b,a)},u.negate=function(a){return function(){return!a.apply(this,arguments)}},u.compose=function(){var a=arguments,b=a.length-1;return function(){for(var c=b,d=a[b].apply(this,arguments);c--;)d=a[c].call(this,d);return d}},u.after=function(a,b){return function(){return--a<1?b.apply(this,arguments):void 0}},u.before=function(a,b){var c;return function(){return--a>0&&(c=b.apply(this,arguments)),1>=a&&(b=null),c}},u.once=u.partial(u.before,2);var G=!{toString:null}.propertyIsEnumerable("toString"),H=["valueOf","isPrototypeOf","toString","propertyIsEnumerable","hasOwnProperty","toLocaleString"];u.keys=function(a){if(!u.isObject(a))return[];if(q)return q(a);var b=[];for(var c in a)u.has(a,c)&&b.push(c);return G&&f(a,b),b},u.allKeys=function(a){if(!u.isObject(a))return[];var b=[];for(var c in a)b.push(c);return G&&f(a,b),b},u.values=function(a){for(var b=u.keys(a),c=b.length,d=Array(c),e=0;c>e;e++)d[e]=a[b[e]];return d},u.mapObject=function(a,b,c){b=w(b,c);for(var d,e=u.keys(a),f=e.length,g={},h=0;f>h;h++)d=e[h],g[d]=b(a[d],d,a);return g},u.pairs=function(a){for(var b=u.keys(a),c=b.length,d=Array(c),e=0;c>e;e++)d[e]=[b[e],a[b[e]]];return d},u.invert=function(a){for(var b={},c=u.keys(a),d=0,e=c.length;e>d;d++)b[a[c[d]]]=c[d];return b},u.functions=u.methods=function(a){var b=[];for(var c in a)u.isFunction(a[c])&&b.push(c);return b.sort()},u.extend=x(u.allKeys),u.extendOwn=u.assign=x(u.keys),u.findKey=function(a,b,c){b=w(b,c);for(var d,e=u.keys(a),f=0,g=e.length;g>f;f++)if(d=e[f],b(a[d],d,a))return d},u.pick=function(a,b,c){var d,e,f={},g=a;if(null==g)return f;u.isFunction(b)?(e=u.allKeys(g),d=v(b,c)):(e=E(arguments,!1,!1,1),d=function(a,b,c){return b in c},g=Object(g));for(var h=0,i=e.length;i>h;h++){var j=e[h],k=g[j];d(k,j,g)&&(f[j]=k)}return f},u.omit=function(a,b,c){if(u.isFunction(b))b=u.negate(b);else{var d=u.map(E(arguments,!1,!1,1),String);b=function(a,b){return!u.contains(d,b)}}return u.pick(a,b,c)},u.defaults=x(u.allKeys,!0),u.create=function(a,b){var c=y(a);return b&&u.extendOwn(c,b),c},u.clone=function(a){return u.isObject(a)?u.isArray(a)?a.slice():u.extend({},a):a},u.tap=function(a,b){return b(a),a},u.isMatch=function(a,b){var c=u.keys(b),d=c.length;if(null==a)return!d;for(var e=Object(a),f=0;d>f;f++){var g=c[f];if(b[g]!==e[g]||!(g in e))return!1}return!0};var I=function(a,b,c,d){if(a===b)return 0!==a||1/a===1/b;if(null==a||null==b)return a===b;a instanceof u&&(a=a._wrapped),b instanceof u&&(b=b._wrapped);var e=n.call(a);if(e!==n.call(b))return!1;switch(e){case"[object RegExp]":case"[object String]":return""+a==""+b;case"[object Number]":return+a!==+a?+b!==+b:0===+a?1/+a===1/b:+a===+b;case"[object Date]":case"[object Boolean]":return+a===+b}var f="[object Array]"===e;if(!f){if("object"!=typeof a||"object"!=typeof b)return!1;var g=a.constructor,h=b.constructor;if(g!==h&&!(u.isFunction(g)&&g instanceof g&&u.isFunction(h)&&h instanceof h)&&"constructor"in a&&"constructor"in b)return!1}c=c||[],d=d||[];for(var i=c.length;i--;)if(c[i]===a)return d[i]===b;if(c.push(a),d.push(b),f){if(i=a.length,i!==b.length)return!1;for(;i--;)if(!I(a[i],b[i],c,d))return!1}else{var j,k=u.keys(a);if(i=k.length,u.keys(b).length!==i)return!1;for(;i--;)if(j=k[i],!u.has(b,j)||!I(a[j],b[j],c,d))return!1}return c.pop(),d.pop(),!0};u.isEqual=function(a,b){return I(a,b)},u.isEmpty=function(a){return null==a?!0:C(a)&&(u.isArray(a)||u.isString(a)||u.isArguments(a))?0===a.length:0===u.keys(a).length},u.isElement=function(a){return!(!a||1!==a.nodeType)},u.isArray=p||function(a){return"[object Array]"===n.call(a)},u.isObject=function(a){var b=typeof a;return"function"===b||"object"===b&&!!a},u.each(["Arguments","Function","String","Number","Date","RegExp","Error"],function(a){u["is"+a]=function(b){return n.call(b)==="[object "+a+"]"}}),u.isArguments(arguments)||(u.isArguments=function(a){return u.has(a,"callee")}),"function"!=typeof/./&&"object"!=typeof Int8Array&&(u.isFunction=function(a){return"function"==typeof a||!1}),u.isFinite=function(a){return isFinite(a)&&!isNaN(parseFloat(a))},u.isNaN=function(a){return u.isNumber(a)&&a!==+a},u.isBoolean=function(a){return a===!0||a===!1||"[object Boolean]"===n.call(a)},u.isNull=function(a){return null===a},u.isUndefined=function(a){return void 0===a},u.has=function(a,b){return null!=a&&o.call(a,b)},u.noConflict=function(){return g._=h,this},u.identity=function(a){return a},u.constant=function(a){return function(){return a}},u.noop=function(){},u.property=z,u.propertyOf=function(a){return null==a?function(){}:function(b){return a[b]}},u.matcher=u.matches=function(a){return a=u.extendOwn({},a),function(b){return u.isMatch(b,a)}},u.times=function(a,b,c){var d=Array(Math.max(0,a));b=v(b,c,1);for(var e=0;a>e;e++)d[e]=b(e);return d},u.random=function(a,b){return null==b&&(b=a,a=0),a+Math.floor(Math.random()*(b-a+1))},u.now=Date.now||function(){return(new Date).getTime()};var J={"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#x27;","`":"&#x60;"},K=u.invert(J),L=function(a){var b=function(b){return a[b]},c="(?:"+u.keys(a).join("|")+")",d=RegExp(c),e=RegExp(c,"g");return function(a){return a=null==a?"":""+a,d.test(a)?a.replace(e,b):a}};u.escape=L(J),u.unescape=L(K),u.result=function(a,b,c){var d=null==a?void 0:a[b];return void 0===d&&(d=c),u.isFunction(d)?d.call(a):d};var M=0;u.uniqueId=function(a){var b=++M+"";return a?a+b:b},u.templateSettings={evaluate:/<%([\s\S]+?)%>/g,interpolate:/<%=([\s\S]+?)%>/g,escape:/<%-([\s\S]+?)%>/g};var N=/(.)^/,O={"'":"'","\\":"\\","\r":"r","\n":"n","\u2028":"u2028","\u2029":"u2029"},P=/\\|'|\r|\n|\u2028|\u2029/g,Q=function(a){return"\\"+O[a]};u.template=function(a,b,c){!b&&c&&(b=c),b=u.defaults({},b,u.templateSettings);var d=RegExp([(b.escape||N).source,(b.interpolate||N).source,(b.evaluate||N).source].join("|")+"|$","g"),e=0,f="__p+='";a.replace(d,function(b,c,d,g,h){return f+=a.slice(e,h).replace(P,Q),e=h+b.length,c?f+="'+\n((__t=("+c+"))==null?'':_.escape(__t))+\n'":d?f+="'+\n((__t=("+d+"))==null?'':__t)+\n'":g&&(f+="';\n"+g+"\n__p+='"),b}),f+="';\n",b.variable||(f="with(obj||{}){\n"+f+"}\n"),f="var __t,__p='',__j=Array.prototype.join,print=function(){__p+=__j.call(arguments,'');};\n"+f+"return __p;\n";try{var g=new Function(b.variable||"obj","_",f)}catch(h){throw h.source=f,h}var i=function(a){return g.call(this,a,u)},j=b.variable||"obj";return i.source="function("+j+"){\n"+f+"}",i},u.chain=function(a){var b=u(a);return b._chain=!0,b};var R=function(a,b){return a._chain?u(b).chain():b};u.mixin=function(a){u.each(u.functions(a),function(b){var c=u[b]=a[b];u.prototype[b]=function(){var a=[this._wrapped];return l.apply(a,arguments),R(this,c.apply(u,a))}})},u.mixin(u),u.each(["pop","push","reverse","shift","sort","splice","unshift"],function(a){var b=i[a];u.prototype[a]=function(){var c=this._wrapped;return b.apply(c,arguments),"shift"!==a&&"splice"!==a||0!==c.length||delete c[0],R(this,c)}}),u.each(["concat","join","slice"],function(a){var b=i[a];u.prototype[a]=function(){return R(this,b.apply(this._wrapped,arguments))}}),u.prototype.value=function(){return this._wrapped},u.prototype.valueOf=u.prototype.toJSON=u.prototype.value,u.prototype.toString=function(){return""+this._wrapped},"function"==typeof define&&define.amd&&define("underscore",[],function(){return u})}).call(this)},{}]},{},[1]);
//# sourceMappingURL=client.map